# issue リリース作業を自動化する #3
[issues #3](https://github.com/cat2151/easychord2mml/issues/3)

# これまでの課題
- リリース作業が手間
- リリース作業を忘れる
    - これの影響を受けるchord2mmlを使うとき混
乱
        - 古いeasychord2mmlが使われることになるので挙動が違って混乱

# 分析
- リリース結果の影響範囲は、CDNと、CDNを参照するchord2mmlである認識。
    - ほかにもありそうだがひとまず気にしないことに。気付いたとき考える。

# 対策案
- agentにリリース作業の自動化の作業をさせる
- 運用イメージ：
    - userはcommit pushだけをする。tag付与しない。
    - GitHub Actions側で、セマンティックバージョニングのパッチバージョンのincrement、tag付与、release、を行う。

# 結果
- release.yml と package.json をagentに生成させた
- agentに内容の解説をさせた
    - userの理解の範囲で改善した
        - 具体的には、package.jsonのdecriptionとauthor

# どうtestする？
- test case:
    - commit pushする
    - GitHub Actionの動作が完了するまで待つ
    - 0.0.7 のrelease がされること
- もし上記test greenならcloseとする、test redならここに可視化して対処する

# test red
- tagが見つからないというエラー
- その後tagをみると生成されていた、pullしてlocalでも確認した
- tagにて`invalid-email-address tagged this` という表示がある → agentに説明させて修正してみた
- 3秒で不足か、それとも30秒でもエラー（別の原因）か、の切り分けのため、30秒にしてみる
- 俯瞰してみる
    - 泥沼感がある
        - userの作業負荷と認知負荷が想定より高まっている、当初はagentだけで自走完了の想定だった

# test red
- LLMに説明させる
    - GitHub ブラウザ側 Actions欄 `Explain error` ボタンで、
    - LLMにエラー内容や対策を説明させればいい、
    - 指示すれば日本語で説明もできる
- 結果、version-bump.yml と release.yml にactionsを分解するという提案を得た
- これで試す

# test red
- version-bump.yml しか動いてない。release.ymlが動いてない
- こうなると、`Explain error`ボタンは使えない
- なので、versipm-bump.ymlのraw logを、agentに食わせて、contextは両方のymlにして、事象をagentに入力して対処させた
- version-bump.ymlの最後のpull前にwaitを入れる、というagent提案を得た
- これで試す

# test red
- 変わらず
- 切り分けのため5秒から30秒にする

# test red
- 変わらず
- このagentでは力不足で埒が明かない、と判断する
- 泥沼
- もうちょっと試す
- 別のLLMに、事象と、2つのymlを貼り付けて説明させた
- 原因の可能性は `[skip ci]` にあるらしい
- これで試す

# test red
- 変わらず
- 別のLLMに引き続き投げたところ、大きく違う内容のversion-bump.ymlを提案してきた
- これで試す
